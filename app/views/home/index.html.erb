<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <h1 class="mb-4"><%= t('views.home.index.title') %></h1>

            <% if current_user %>
        <div class="alert alert-info d-flex align-items-center">
          <i class="fas fa-user-circle me-2"></i>
          <div>
            <strong><%= t('views.home.index.hello_user', name: split_name(current_user.email)) %></strong>
            <span class="badge bg-secondary ms-2"><%= current_user.role.humanize %></span>
          </div>
        </div>
      <% else %>
        <div class="alert alert-warning d-flex align-items-center">
          <i class="fas fa-user-circle me-2"></i>
          <div>
            <strong><%= t('views.home.index.hello_visitor') %></strong>
            <span class="badge bg-secondary ms-2"><%= t('views.home.index.login_to_order') %></span>
          </div>
        </div>
      <% end %>

      <div class="card mb-4">
        <div class="card-body">
          <%= search_form_for @q, url: root_path, local: true, class: "d-flex flex-wrap gap-3 align-items-end" do |form| %>
            <div class="flex-grow-1" style="min-width: 200px;">
              <%= form.select :user_id_eq, 
                             options_for_select(@restaurants.map { |name, id| [name, id] }, @q.user_id_eq),
                             { prompt: "Selecionar restaurante..." }, 
                             { class: "form-select" } %>
            </div>
            <div class="flex-grow-1" style="min-width: 200px;">
              <%= form.select :s, 
                             options_for_select([
                               [t('views.home.index.sort_by.newest'), 'created_at desc'],
                               [t('views.home.index.sort_by.price_asc'), 'price asc'],
                               [t('views.home.index.sort_by.price_desc'), 'price desc'],
                               [t('views.home.index.sort_by.name'), 'name asc'],
                               [t('views.home.index.sort_by.restaurant'), 'user_email asc']
                             ], @q.sorts.first&.to_s), 
                             { prompt: t('views.home.index.sort_by.label') }, 
                             { class: "form-select" } %>
            </div>
            <div class="ms-auto d-flex gap-2">
              <%= form.submit t('views.home.index.apply'), class: "btn btn-primary" %>
              <%= link_to t('views.home.index.clear'), root_path, class: "btn btn-outline-secondary" %>
            </div>
          <% end %>
        </div>
      </div>

      <% if @foods&.any? %>
        <div class="row">
          <% @foods.each do |food| %>
            <div class="col-md-6 col-lg-4 col-xl-3 mb-4">
              <div class="card food-card h-100 shadow-lg">
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title text-primary"><%= food.name %></h5>
                  <p class="card-text text-muted small mb-2">
                    <i class="fas fa-store"></i> 
                    <strong><%= food.user.email.split('@').first.humanize %></strong>
                  </p>
                  <p class="card-text mb-3 flex-grow-1"><%= truncate(food.description, length: 100) %></p>
                  <div class="d-flex justify-content-between align-items-center mt-auto">
                    <span class="price-tag">
                      R$ <%= number_to_currency(food.price, unit: "", precision: 2) %>
                    </span>
                    <% if current_user&.cliente? %>
                      <div>
                        <%= link_to food_path(food), class: "btn btn-outline-info btn-sm " do %>
                          <i class="fas fa-eye"></i>
                        <% end %>
                        <%= link_to new_order_path(food_id: food.id), class: "btn btn-success btn-sm" do %>
                          <i class="fas fa-shopping-cart"></i>
                        <% end %>
                      </div>
                    <% elsif !current_user %>
                      <%= link_to new_user_session_path, 
                                 class: "btn btn-outline-primary btn-sm" do %>
                        <i class="fas fa-sign-in-alt me-1"></i><%= t('views.home.index.login') %>
                      <% end %>
                    <% end %>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>

        <div class="d-flex flex-column align-items-center mt-4">
          <div class="pagination-info mb-3">
            <%= t('views.home.index.pagination_info', current: @foods.current_page, total: @foods.total_pages, count: @foods.total_count) %>
          </div>
          <%= paginate @foods %>
        </div>
      <% else %>
        <div class="text-center py-5">
          <div class="mb-4">
            <i class="fas fa-utensils fa-4x text-muted"></i>
          </div>
          <h3 class="text-muted mb-3"><%= t('views.home.index.no_foods') %></h3>
          <p class="text-muted mb-4">
            <%= t('views.home.index.no_foods_description') %>
          </p>
          <div class="d-flex flex-column flex-md-row gap-2 justify-content-center">
            <% if !current_user %>
              <%= link_to new_user_registration_path, class: "btn btn-success me-2" do %>
                <i class="fas fa-user-plus me-2"></i><%= t('views.home.index.register_restaurant') %>
              <% end %>
              <%= link_to restaurantes_path, class: "btn btn-outline-primary" do %>
                <i class="fas fa-store me-2"></i><%= t('views.home.index.view_restaurants') %>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
