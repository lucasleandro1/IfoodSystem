<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <h1 class="mb-4">Comidas</h1>

      <% if current_user %>
        <div class="alert alert-info d-flex align-items-center">
          <i class="fas fa-user-circle me-2"></i>
          <div>
            <strong>Olá, <%= split_name(current_user.email) %>!</strong>
            <span class="badge bg-secondary ms-2"><%= current_user.role.humanize %></span>
          </div>
        </div>
      <% end %>

      <div class="card mb-4">
        <div class="card-body">
          <%= form_with url: root_path, method: :get, local: true, class: "row g-3" do |form| %>
            <div class="col-md-6">
              <%= form.select :sort_by, 
                             options_for_select([
                               ['Mais recentes', ''],
                               ['Menor preço', 'price_asc'],
                               ['Maior preço', 'price_desc'],
                               ['Nome A-Z', 'name'],
                               ['restaurante A-Z', 'restaurante']
                             ], params[:sort_by]), 
                             { prompt: "Ordenar por..." }, 
                             { class: "form-select" } %>
            </div>
            <div class="col-md-3">
              <%= form.submit "Aplicar", class: "btn btn-primary" %>
            </div>
            <div class="col-md-3">
              <%= link_to "Limpar", root_path, class: "btn btn-outline-secondary" %>
            </div>
          <% end %>
        </div>
      </div>

      <% if @foods&.any? %>
        <div class="row">
          <% @foods.each do |food| %>
            <div class="col-md-6 col-lg-4 col-xl-3 mb-4">
              <div class="card food-card h-100">
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title text-primary"><%= food.name %></h5>
                  <p class="card-text text-muted small mb-2">
                    <i class="fas fa-store"></i> 
                    <strong><%= food.user.email.split('@').first.humanize %></strong>
                  </p>
                  <p class="card-text mb-3 flex-grow-1"><%= truncate(food.description, length: 100) %></p>
                  <div class="d-flex justify-content-between align-items-center mt-auto">
                    <span class="price-tag">
                      R$ <%= number_to_currency(food.price, unit: "", precision: 2) %>
                    </span>
                    <% if current_user&.cliente? %>
                      <div>
                        <%= link_to food_path(food), class: "btn btn-outline-info btn-sm " do %>
                          <i class="fas fa-eye"></i>
                        <% end %>
                        <%= link_to new_order_path(food_id: food.id), class: "btn btn-success btn-sm" do %>
                          <i class="fas fa-shopping-cart"></i>
                        <% end %>
                      </div>
                    <% elsif !current_user %>
                      <%= link_to new_user_session_path, 
                                 class: "btn btn-outline-primary btn-sm" do %>
                        <i class="fas fa-sign-in-alt me-1"></i>Entrar
                      <% end %>
                    <% end %>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-5">
          <div class="mb-4">
            <i class="fas fa-utensils fa-4x text-muted"></i>
          </div>
          <h3 class="text-muted mb-3">Nenhuma comida encontrada</h3>
          <p class="text-muted mb-4">
            Ainda não há comidas cadastradas no sistema.
          </p>
          <div class="d-flex flex-column flex-md-row gap-2 justify-content-center">
            <% if !current_user %>
              <%= link_to new_user_registration_path, class: "btn btn-success me-2" do %>
                <i class="fas fa-user-plus me-2"></i>Cadastrar como restaurante
              <% end %>
              <%= link_to restaurantes_path, class: "btn btn-outline-primary" do %>
                <i class="fas fa-store me-2"></i>Ver restaurantes
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
