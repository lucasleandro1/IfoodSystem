<div class="col-12 mb-4">
  <div class="card">
    <div class="card-body">
      <div class="row">
        <div class="col-md-8">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <h5 class="card-title text-primary mb-0">
              <%= t('views.orders.index.order_number', id: order.id) %>
            </h5>
            <span class="badge bg-<%= status_badge_class(order.status) %> fs-6">
              <%= order.status&.humanize || "Indefinido" %>
            </span>
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <p class="mb-1">
                <i class="fas fa-clock text-muted me-2"></i>
                <strong><%= t('views.orders.index.datetime') %></strong> <%= order.requested_at.strftime("%d/%m/%Y Ã s %H:%M") %>
              </p>
              <p class="mb-1">
                <i class="fas fa-utensils text-muted me-2"></i>
                <strong><%= t('views.orders.index.food') %></strong> <%= order.item_description %>
              </p>
              <% if current_user.cliente? %>
                <p class="mb-1">
                  <i class="fas fa-store text-muted me-2"></i>
                  <strong><%= t('views.orders.index.restaurant') %></strong> <%= order.food.user.email.split('@').first.humanize %>
                </p>
              <% else %>
                <p class="mb-1">
                  <i class="fas fa-user text-muted me-2"></i>
                  <strong><%= t('views.orders.index.client') %></strong> <%= split_name(order.user.email) %>
                </p>
              <% end %>
            </div>
            <div class="col-md-6">
              <p class="mb-1">
                <i class="fas fa-sort-numeric-up text-muted me-2"></i>
                <strong><%= t('views.orders.index.quantity') %></strong> <%= order.quantity %>
              </p>
              <p class="mb-1">
                <i class="fas fa-dollar-sign text-muted me-2"></i>
                <strong><%= t('views.orders.index.value') %></strong> 
                <span class="price-tag">R$ <%= number_to_currency(order.estimated_value, unit: "", precision: 2) %></span>
              </p>
              <p class="mb-1">
                <i class="fas fa-credit-card text-muted me-2"></i>
                <strong><%= t('views.orders.index.payment') %></strong> <%= order.payment_method&.humanize || "N/A" %>
              </p>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <p class="mb-1 text-muted small">
                <i class="fas fa-map-marker-alt me-1"></i>
                <strong><%= t('views.orders.index.pickup') %></strong><br>
                <%= "#{order.pickup_address.street}, #{order.pickup_address.number} - #{order.pickup_address.neighborhood}" %>
              </p>
            </div>
            <div class="col-md-6">
              <p class="mb-1 text-muted small">
                <i class="fas fa-home me-1"></i>
                <strong><%= t('views.orders.index.delivery') %></strong><br>
                <%= "#{order.delivery_address.street}, #{order.delivery_address.number} - #{order.delivery_address.neighborhood}" %>
              </p>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="d-flex flex-column gap-2">
          <% if current_user.cliente? %>
              <%= link_to order_path(order), class: "btn btn-outline-primary" do %>
                <i class="fas fa-eye me-2"></i><%= t('views.orders.index.view_details') %>
              <% end %>
            <% end %>

            <% if current_user.restaurante? %>
              <%= form_with model: order, url: order_path(order), method: :patch, local: true do |f| %>
                <div class="d-flex gap-2">
                  <%= f.select :status, Order.statuses.keys.map { |s| [s.humanize, s] }, 
                      { selected: order.status }, 
                      { class: "form-select form-select-sm" } %>
                  <%= f.submit t('views.orders.index.update'), class: "btn btn-sm btn-success" %>
                </div>
              <% end %>
            <% end %>

            <% if current_user.cliente? && order.pendente? %>
              <%= button_to order_path(order), 
                  method: :patch, 
                  params: { order: { status: 'cancelado' } }, 
                  data: { confirm: t('views.orders.index.cancel_confirm') },
                  class: "btn btn-sm btn-danger" do %>
                <i class="fas fa-times me-2"></i><%= t('views.orders.index.cancel_order') %>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>