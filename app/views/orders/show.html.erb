<div class="container">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>
          <i class="fas fa-receipt me-2"></i>
          Detalhes do Pedido #<%= @order.id %>
        </h1>
        <span class="badge bg-<%= status_badge_class(@order.status) %> fs-5">
          <%= @order.status&.humanize || "Indefinido" %>
        </span>
      </div>

      <div class="row">
        <div class="col-md-8">
          <div class="card mb-4">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-info-circle me-2"></i>Informações do Pedido
              </h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="text-muted small">Produto</label>
                    <p class="mb-0 fw-bold">
                      <i class="fas fa-utensils me-2 text-primary"></i>
                      <%= @order.item_description %>
                    </p>
                  </div>
                  
                  <div class="mb-3">
                    <label class="text-muted small">Quantidade</label>
                    <p class="mb-0">
                      <i class="fas fa-sort-numeric-up me-2 text-secondary"></i>
                      <%= @order.quantity %>
                    </p>
                  </div>

                  <div class="mb-3">
                    <label class="text-muted small">Valor Total</label>
                    <p class="mb-0 fw-bold text-success fs-5">
                      <i class="fas fa-dollar-sign me-2"></i>
                      R$ <%= number_to_currency(@order.estimated_value, unit: "", precision: 2) %>
                    </p>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="text-muted small">Data do Pedido</label>
                    <p class="mb-0">
                      <i class="fas fa-clock me-2 text-info"></i>
                      <%= @order.requested_at.strftime("%d/%m/%Y às %H:%M") %>
                    </p>
                  </div>

                  <div class="mb-3">
                    <label class="text-muted small">Método de Pagamento</label>
                    <p class="mb-0">
                      <i class="fas fa-credit-card me-2 text-warning"></i>
                      <%= @order.payment_method&.humanize || "N/A" %>
                    </p>
                  </div>

                  <% if current_user.restaurante? %>
                    <div class="mb-3">
                      <label class="text-muted small">cliente</label>
                      <p class="mb-0">
                        <i class="fas fa-user me-2 text-secondary"></i>
                        <%= split_name(@order.user.email) %>
                      </p>
                    </div>
                  <% elsif current_user.cliente? %>
                    <div class="mb-3">
                      <label class="text-muted small">restaurante</label>
                      <p class="mb-0">
                        <i class="fas fa-store me-2 text-secondary"></i>
                        <%= @order.food.user.email.split('@').first.humanize %>
                      </p>
                    </div>
                  <% end %>
                </div>
              </div>
            </div>
          </div>

          <div class="card mb-4">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-map-marker-alt me-2"></i>Endereços
              </h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <div class="border rounded p-3 bg-light">
                    <h6 class="text-primary mb-2">
                      <i class="fas fa-store me-2"></i>Coleta
                    </h6>
                    <p class="mb-0 small">
                      <%= @order.pickup_address.address_line %>
                    </p>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="border rounded p-3 bg-light">
                    <h6 class="text-success mb-2">
                      <i class="fas fa-home me-2"></i>Entrega
                    </h6>
                    <p class="mb-0 small">
                      <%= @order.delivery_address.address_line %>
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-cogs me-2"></i>Ações
              </h5>
            </div>
            <div class="card-body">
              <div class="d-grid gap-2">
                <%= link_to orders_path, class: "btn btn-outline-primary" do %>
                  <i class="fas fa-arrow-left me-2"></i>Voltar aos Pedidos
                <% end %>

                <% if current_user.restaurante? %>
                  <%= form_with model: @order, url: order_path(@order), method: :patch, local: true do |f| %>
                    <div class="mb-2">
                      <%= f.label :status, "Status do Pedido:", class: "form-label small" %>
                      <%= f.select :status, Order.statuses.keys.map { |s| [s.humanize, s] }, 
                          { selected: @order.status }, 
                          { class: "form-select form-select-sm" } %>
                    </div>
                    <%= f.submit "Atualizar Status", class: "btn btn-success w-100" %>
                  <% end %>
                <% end %>

                <% if current_user.cliente? && @order.pendente? %>
                  <%= button_to order_path(@order), 
                      method: :patch, 
                      params: { order: { status: 'cancelado' } }, 
                      data: { confirm: 'Tem certeza que deseja cancelar o pedido?' },
                      class: "btn btn-danger" do %>
                    <i class="fas fa-times me-2"></i>Cancelar Pedido
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>

          <% unless @order.pendente? %>
            <div class="card mt-3">
              <div class="card-header">
                <h6 class="mb-0">
                  <i class="fas fa-history me-2"></i>Histórico
                </h6>
              </div>
              <div class="card-body">
                <div class="timeline">
                  <div class="timeline-item <%= 'active' if @order.pendente? || @order.preparando? || @order.em_rota? || @order.entregue? %>">
                    <i class="fas fa-check-circle"></i>
                    <span>Pedido Confirmado</span>
                  </div>
                  <div class="timeline-item <%= 'active' if @order.preparando? || @order.em_rota? || @order.entregue? %>">
                    <i class="fas fa-utensils"></i>
                    <span>Preparando</span>
                  </div>
                  <div class="timeline-item <%= 'active' if @order.em_rota? || @order.entregue? %>">
                    <i class="fas fa-truck"></i>
                    <span>Em Rota</span>
                  </div>
                  <div class="timeline-item <%= 'active' if @order.entregue? %>">
                    <i class="fas fa-home"></i>
                    <span>Entregue</span>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.timeline {
  position: relative;
}

.timeline-item {
  display: flex;
  align-items: center;
  margin-bottom: 1rem;
  opacity: 0.5;
  transition: all 0.3s ease;
}

.timeline-item.active {
  opacity: 1;
  color: #28a745;
}

.timeline-item i {
  margin-right: 0.5rem;
  width: 20px;
}

.timeline-item.active i {
  color: #28a745;
}
</style>
